/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import state from"./state.js";import*as gmailResponseService from"./gmail-response-service.js";import{removeAllAcrobatTouchPoints,createURLForAttachment}from"./util.js";import{sendAnalytics,getDefaultViewershipStatusEvar}from"../gsuite/util.js";const DEFAULT_VIEWERSHIP_STORAGE_KEY="gmail-pdf-default-viewership",DEFAULT_VIEWERSHIP_SESSION_COUNT_STORAGE_KEY="gmail-pdf-default-viewership-session-count",isDefaultViewershipFeatureForGmailEnabled=()=>state?.gmailConfig?.enableDefaultViewershipFeatureForGmail,isDefaultViewer=()=>isDefaultViewershipFeatureForGmailEnabled()&&state.isAcrobatDefaultForGmailPDFs&&chrome.runtime.id,takeDefaultViewerShip=()=>{isDefaultViewershipFeatureForGmailEnabled()&&!isDefaultViewer()&&(state.isAcrobatDefaultForGmailPDFs=!0,state?.resetDOMElementListener(),gmailResponseService.init(),removeAllAcrobatTouchPoints())},resetDefaultViewership=()=>{state.isAcrobatDefaultForGmailPDFs=!1,state?.resetDOMElementListener(),removeAllAcrobatTouchPoints(),gmailResponseService.init()},isPartOfExperimentCohort=()=>state?.gmailConfig?.isUserPartOfExperimentControlOrTreatmentForGmailDV,getDefaultViewershipEvar=()=>getDefaultViewershipStatusEvar(isDefaultViewer(),isDefaultViewershipFeatureForGmailEnabled(),"gmail",isPartOfExperimentCohort()),sendAnalyticsWithGMailDVFeatureStatus=e=>{sendAnalytics([[e[0],getDefaultViewershipEvar()]])},fetchDefaultViewershipConfig=async()=>(await chrome.storage.local.get("gmail-pdf-default-viewership"))?.["gmail-pdf-default-viewership"]||{},getDVSessionCount=()=>chrome.storage.local.get("gmail-pdf-default-viewership-session-count").then((e=>e?.["gmail-pdf-default-viewership-session-count"]||0)),getDVSessionCountString=()=>getDVSessionCount().then((e=>e<5?e.toString():"5_or_more")),incrementDVSessionCount=()=>{getDVSessionCount().then((e=>{chrome.storage.local.set({[DEFAULT_VIEWERSHIP_SESSION_COUNT_STORAGE_KEY]:e+1})}))},resetDVSessionCount=()=>{chrome.storage.local.set({[DEFAULT_VIEWERSHIP_SESSION_COUNT_STORAGE_KEY]:0})},openPdfInNewTab=e=>{const t=createURLForAttachment(e.url,e.touchPoint,e.attachmentName);window.open(t,"_blank"),incrementDVSessionCount()},sendAnalyticsWithDefaultViewershipFeatureStatus=()=>{state?.gmailConfig?.enableDefaultViewershipFeatureForGmail&&sendAnalytics([["DCBrowserExt:Gmail:DefaultViewershipFeature:Enable"]]),state?.gmailConfig?.isUserPartOfExperimentControlOrTreatmentForGmailDV&&!state?.gmailConfig?.enableDefaultViewershipFeatureForGmail&&sendAnalytics([["DCBrowserExt:Gmail:DefaultViewershipFeatureControl:Enable"]])};export{takeDefaultViewerShip,resetDefaultViewership,isDefaultViewer,sendAnalyticsWithGMailDVFeatureStatus,fetchDefaultViewershipConfig,getDVSessionCountString,resetDVSessionCount,openPdfInNewTab,sendAnalyticsWithDefaultViewershipFeatureStatus};