/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="acrobatContentScriptDisconnectStart",t="acrobatContentScriptDisconnectEnd",n="acrobat-gmail-fte-config";let o,i,r,c,a,s,l,m;const d=()=>{r?.addAcrobatTouchPointInTheMessageView(),c?.processForListView(),i?.processForAlreadyShownNativeViewerPrompt(),i?.sendAnalyticsForImageAssetInteraction()},u=new MutationObserver((function(){m?.disconnectBodyObserver?u.disconnect():(u.takeRecords(),chrome?.runtime?.id?d():(s?.removeAllAcrobatTouchPoints(),u?.disconnect()))})),g=()=>{if(document?.body)try{const e={childList:!0,subtree:!0};u.observe(document.body,e)}catch(e){}else setTimeout(g,500)},h=()=>{window.addEventListener(t,(e=>m.contentScriptDisconnectEnd(e)),{signal:m?.eventControllerSignal}),window.addEventListener(e,(()=>(e=>{if(!chrome.runtime?.id){const n=e.createStateToTransferToNewContentScript();e.contentScriptDisconnectStart(),u?.disconnect(),window.dispatchEvent(new CustomEvent(t,{detail:{state:n}}))}})(m)),{signal:m?.eventControllerSignal})},p=()=>{h(),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new CustomEvent(e)),(()=>{if(m?.adobeCleanFontAdded)return;const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),t=new FontFace("AdobeClean-Regular",`url(${e})`);t.load().then((()=>{document.fonts.add(t)})),m.adobeCleanFontAdded=!0})()},w=async e=>{const t=chrome.runtime.getURL("content_scripts/gmail/state.js");m=(await import(t)).default,(e=>{m&&(m.gmailConfig=e,m.iconURL=chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"),m.iconURLListView=chrome.runtime.getURL("browser/images/acrobat_dc_trefoil_24_white.svg"),m.viewerURLPrefix=chrome.runtime.getURL("viewer.html"))})(e),p();const n=chrome.runtime.getURL("content_scripts/gmail/gmail-response-service.js"),d=chrome.runtime.getURL("content_scripts/gmail/native-viewer-touch-point-service.js"),u=chrome.runtime.getURL("content_scripts/gmail/message-view-touch-point-service.js"),g=chrome.runtime.getURL("content_scripts/gmail/list-view-touch-point-service.js"),h=chrome.runtime.getURL("content_scripts/gsuite/util.js"),w=chrome.runtime.getURL("content_scripts/gmail/util.js"),b=chrome.runtime.getURL("content_scripts/gmail/default-viewership-service.js");return Promise.all([import(n),import(d),import(u),import(g),import(w),import(h),import(b)]).then((e=>{o=e[0],o.init(),i=e[1],r=e[2],c=e[3],s=e[4],a=e[5],l=e[6]}))};chrome.runtime.onMessage.addListener((function(e){"acrobatGmailFteStateUpdated"===e.content_op?m.fteToolTip={...m.fteToolTip,...e?.fteState}:"changeDefaultViewershipForSurface"===e.content_op?"gmail"===e?.surfaceId&&chrome.runtime.id&&(e?.isDefault?l?.takeDefaultViewerShip():l?.resetDefaultViewership(),h(),d()):"acrobatGsuiteTouchPointsDisabled"===e.content_op&&(m.gmailConfig.touchPointSettingEnabled=!1,m?.isAcrobatDefaultForGmailPDFs||(u?.disconnect(),s?.removeAllAcrobatTouchPoints(),m?.disconnectEventListeners()))})),window.location?.search?.includes("acrobatPromotionSource")||chrome.runtime?.sendMessage({main_op:"gmail-init"},(e=>{(e.touchPointSettingEnabled||e?.isAcrobatDefaultForSurface)&&(e.enableAttachmentCardPromptInGmail||window.location?.search?.includes("enableAcrobatPromptInGmail"))&&w(e).then((()=>{var t;(async()=>{const e=(new Date).getTime();let t={count:0,nextDate:e};t=(await chrome.storage.local.get(n))?.[n]||t;const o=m?.gmailConfig?.fteConfig?.tooltip;((e,t)=>-1!==e?.resetDay&&t>e?.resetDay)(o,e)&&(t.count=0,t.nextDate=e),m.fteToolTip={eligibleFte:{type:""},...t},t={[n]:t},chrome.storage.local.set(t)})(),t=e,m.isAcrobatDefaultForGmailPDFs=t?.isAcrobatDefaultForSurface,l?.sendAnalyticsWithDefaultViewershipFeatureStatus(),s?.removeAllAcrobatTouchPoints(),d(),g(),a?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:PromotionFeature:Enable"),e?.enableGmailFteToolTip&&a?.sendAnalyticsOncePerMonth("DCBrowserExt:Gmail:FTE:Enable")}))}))})();